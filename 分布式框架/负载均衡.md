# 负载均衡
## 概述
负载均衡，是将请求根据特定的算法均衡到多个服务节点上，从而提高处理能力。

## 常见的负载均衡算法
常见的负载均衡算法有
- 轮询法
- 随机法
- 源地址哈希法
- 加权轮询法
- 加权随机法
- 最小连接数法

## 类型
从实现层面上来看，负载均衡有多种类型
- DNS负载均衡
- IP层负载均衡
- 链路层负载均衡

### DNS负载均衡
DNS 负载均衡技术是通过利用域名解析来实现负载均衡的，在 DNS 服务器，通过配置域名关联多个 ip 地址的服务器，在请求域名的时候，DNS服务器充当了负载调度器，将请求均衡到多个服务器上。
优点：
1. 使用简单：负载均衡的工作交给DNS服务器处理，省掉了维护负载均衡服务器维护的麻烦
2. 提高性能：可以支持基于地址的域名解析，解析到距离用户最近的服务器地址，加快访问速度，提高性能

缺点：
1. 可用性差：DNS 解析是多级解析，新增/修改DNS后，生效时间较慢，在解析过程将会影响用户访问
2. 扩展性低：DNS负载均衡的控制权在域名商那里，无法对其做更多的改善和扩展
3. 维护性差：不能反映服务器的当前运行状态；支持的算法少；不能根据系统与服务的状态来判断负载

### IP负载均衡
IP层负载均衡是作用在网络层上的，请求报文到达网络层时，负载均衡调度器通过负载均衡算法得到一台真实的服务器地址，然后将请求目的地址修改为具体的机器之地，转发到指定的服务器。
服务器处理完成，将响应发送到负载均衡调度器，然后再将响应包的源地址修改负载均衡调度器的ip地址，返回给用户

IP负载均衡，真实物理服务器返回给负载均衡服务器，存在两种方式：
> 1负载均衡服务器在修改目的ip地址的同时修改源地址。将数据包源地址设为自身地址，即源地址转换（snat）
> 2将负载均衡服务器同时作为真实物理服务器集群的网关服务器

优点：
1. 在内核进程完成数据分发，比在应用层分发性能更好
缺点：
1. 所有请求响应都需要经过负载均衡服务器，集群最大吞吐量受限于负载均衡服务器网卡带宽

### 链路层负载均衡
链路层负载均衡是作用在数据链路层的，报文到达均衡器进行分发时，不修改 ip 地址，通过修改目标服务器的 mac 地址，配置真实物理服务器集群所有机器虚拟ip和负载均衡服务器ip一直，达到不修改报文的源地址和目标地址，进行数据分发的目的。
实际处理服务器ip和数据请求目的ip一致，不需要经过负载均衡服务器进行地址转换，可将响应数据包直接返回给用户，皮面负载均衡服务器网卡带宽成为瓶颈（DR模式）
优点：性能好
缺点：配置复杂

## 常用的负载均衡

## 附录
参考博客：
四层与七层负载均衡的区别 https://www.jianshu.com/p/fa937b8e6712